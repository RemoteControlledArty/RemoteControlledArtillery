/*
	TO DO / DONE LIST
*/

*NOTE to self, marker moving with ctrl+lmb is extremly practical for correcting fire and aiming multiple smokes!
*NOTE to self, AT mines should be deployed about 20m after a unifying crossroad, not on it, due to inaccuracy
*NOTE to self, wood+too few sandbag roof of usual MG/GMG bunkers do luckly not protect against 155mm airburst


TO DO - BUGFIXES:

-does it still need include check for ace hpp?	*according to Fluffy likely yes, for the mortar
-REPORT BUG to ace team: crl+h cuts connection and destroys UV
-ar2 problems on server, is it due to some of the scripts, or a server issue?
-turret is locked unable to adjust up/down, when scope of player is adjustable...
-later: enable artillery overlay in non UGV gunner seat of N/LOS FSV
-RC Recon RADAR activated by default to make it actually usefull (works when deleting commander and activating it manual, or human ai is in there, not with uav ai even with https://community.bistudio.com/wiki/setVehicleRadar)
-lockseats didnt work for FSV/MBT


TO DO - FEATURES:

documentation:
-add new assets to cfg patches list

*Fluffy says locking is global, meaning locking rc gunner/driver from going to commander/passenger... OOOF *if in driver and currently controlling, lock other seats

if (!isserver) exitwith {}; = server client only, not every player client
*HOW does it affect "player side"...?

Rooicat eventhandler
class EventHandlers: EventHandlers
{
	postinit="if (local (_this select 0)) then {[(_this select 0), """", [], false] call bis_fnc_initVehicle;};";
};

*Fluffy said respawn is global and it would create a respawn per player, i should look for a "serverinit", or test on a server if thats somehow prevented

arty:
-test gps marker with vehicle
this spawn {while {true} do {(side player) reportRemoteTarget [_this, 5]; sleep 1;};};

-eta, test fired EH in loop
-warheadName HE/TandemHEAT ?
-make sure blastcore etc doesnt remove ground dust animation
-recon radar+vehicle mortar composition (maybe hide legs)
-remove non airburst HE after trajectory testing

general:
-decrease guided to 5 or 4? *Cap said 4
-proximityExplosionDistance= ;
-update right/left panel options, except for arty
-fix Static AT laser engaging (how!?)
-display options except arty (edit, what is meant?)

RC IC:
-hide seats for RC IC
-fix smokelauncher
-later: if hull and engine is red then remove AI until repaired, so it doesnt keep getting engaged (explosion timer shortend for now)
-later: fix or remove datalink panel (removed for now)
-later: how to add T14 like driver screen?

RC Respawn Truck (not priority, can be post update):
-fix camera on those who have problems
-lock seats
-add working respawn script
-later: edit hitpoints? *for now threat/cost reduced

FSV/MBT:
//EDIT eventhandler, locking driver seat doesnt work
-if rc driver then lock gunner/commander but UNLOCK if release, if gunner/commander then lock driver
-fix driver forceoptics not working

AR-short:
-making sure effect is reset when leaving uav
-limit range of grenade dropping uav to 3km from user

_uav = getConnectedUAV player;
_viewPos = screenToWorld [0.5, 0.5];
_uavPos = getpos _uav;
_distance = _viewPos distance _uavPos;
hintSilent format ["distance: %1", _distance];

KK_fnc_trueZoom = {(([0.5,0.5] distance2D  worldToScreen positionCameraToWorld [0,3,4]) * (getResolution select 5) / 2)};

while {true} do
{ 
	_uavPos = getpos (getConnectedUAV player);
	_playerPos = getpos player;
	_viewPos = screenToWorld [0.5, 0.5];
	
	//_playerDistance = _uavPos distance _playerPos;
	//_viewDistance = _uavPos distance _viewPos;
	_viewDistance = _playerPos distance _viewPos;  
	
	_zoomBlur = (round (call KK_fnc_trueZoom * 10) / 10)*0.04;
	//_connection = 1+(_distance * 0.0008)^5;
	//_connectionBlur = 1;
	_viewBlur = 1;
	//if (_playerDistance >= 1000) then {_connectionBlur = 1+((_playerDistance-1000) * 0.005)^4};
	if (_viewDistance >= 1000) then {_viewBlur = 1+((_viewDistance-1000) * 0.0035)^4};
	//_finalBlur = 1;
	_finalBlur = 0.1 * _viewBlur * _zoomBlur;
	//hintSilent format ["distance: %1", _distance];
	hintSilent format ["blur: %1", _finalBlur];
	
	
	_blur = ppEffectCreate ["dynamicBlur", 401];
	_blur ppEffectEnable true;
	_blur ppEffectAdjust [_finalBlur];
	_blur ppEffectCommit 0;
};



TO DO (later) - QUALITY OF LIFE:

-only disable driver = 4, for modularity *
-maybe turret azimuth lock hotkey, for when changing EL on uneven ground throws it off
-get missle feed panel to connect to missle
-magazine shell count attributes code? (Who wrote this, what is meant by it?)


Postponed:

-look up if inheriting structure is fully correct
-submunition alternative misslecam
-misslecam activates for N/LOS FSV guided, but doesnt follow it, seems to have something to do with cfgvehicles atleast to trigger


IDEAS - FAR FUTURE:

-sensor ammo, like attaching hidden vehicle with 360deg sensor, deploy xmeter over target, then limited lifetime
-parachute cam round for spotting (or simply additional rhs comp mod for hunt ir, maybe with datalink/laser)
-counterbattery radar, reporting targets to datalink network, with cba settings on detection speed and range

-hotkey to mark selected datalink target on map with time (and maybe speed)

-disconnect uav/ugv from terminal script when vanilla incapacitated / ace unconcious

-AR-0.5 pvp, with 1.5 zoom to force low flying, shortrange sensors, no thermal, but laser designator
-RC Marid with upgraded engines 7.62x51 and smoke GL
-test passive radar shells against active radar AA
-direct fire firing solution (camera viewpoint)
-colored xmeter radius for Azimuth&GunEL, for fire adjustments
-maybe add max spread display / hit propability display (HEAB = 30m radius, inaccuracy at marked distance = ? radius, = ? hit probability)
-video partially at night for rocket and explosion effects
-make MLRS/MRL rockets appear in launcher (if possible)
-https://community.bistudio.com/wiki/lockCameraTo  /  https://community.bistudio.com/wiki/enableDirectionStabilization  /  https://community.bistudio.com/wiki/camSetTarget
-azimuth camera lock (marker, laser, selected, off), as uneven surfaces make keeping azimuth aligned problematic
-or atleast hotkey to swing to azimuth *cannot lock directly to direction of target to az changing with uneven ground
-vanilla asset overwrite for gamemodes without zeus etc *maybe by second pbo and config, class RC_Howitzer; class vanilla_Howitzer: vanilla_Howitzer  but likely doesnt work
-switch driver and commander of recon radar
-3R MRSI display
-turret elevationmode=3 (switchable between manual and automatic), changing script to low trajectory, and point of aim height instead ground height


---------------------------------------------------------------------------------------------------------


DONE - BUGFIXES:

-UI fixed on normal UI scale
-lights off, can simply be done by user in the UAV terminal
-Olive Backpack picture background fix
-armor value fixes
-changed to 9.8066 Gravity
-engine turnoff delay exceptions now per cfg value
-if does not camera points in sky (cannot find range), show red warning "raise camera", (accuracy will be way off and submunitions wont deploy otherwise)
-fix radar turrets viewoptics maxhorrotspeed
-fixed distance calculation
-fixed time of flight calculation
-engine turnoff now per cfg value, so it doesnt affect other ugv's
-found cause for sicnificant over/under-shoot, for low trajectory 0.X MIL are indeed needed, otherwise it will show the same solution despite different distance
-0.X MIL dont have to be shown on screen, but green highlight could be limited to +-0.25 instead of 1


DONE - FEATURES:

-added 82mm, 120mm, 155mm, 230mm HE Airburst
-added 82mm, 120mm, 155mm Laser Guided 1.8m Delayed Fuse (for use against small bunkers/ hangars/ ammo storage halls) but only available per attributes edit for balancing reasons
-improved spread of cluster and mines
-buffed smoke of 82mm, 120mm, 155mm
-added 82mm AP and AT mines
-40 magazines for all shells
-required low&high turret elevation display + ETA
-if turret azimuth matches target azimuth, turn green
-if charge is correct for target distance, turn green
-if azimuth correct, turret elevation correct "ready to fire"
-warning if camera is pointed not at sky

(new)
-ammunition naming improvements
-added Datalink panel
-added Datalink laser position finder
-added Datalink selected target position finder
-added AR-1 & 3
-added 604mm ATACMS
-added RC Infantry Carrier
-renamed assets for clarity
-155mm dispersion fixed
-more but finer 155mm charges, to have more angle variety, and enough airburst even with low angle solution
-added optional 67km datalink range (max firing range)
-added peak ASL calculation formula
-shortend map marker search time (as its only running during active remote control, and improves quality of life)
-fixed all sensor configs
-added 82mm/120/155mm/230mm MultiGuided (Can in manual fire lock laser and vehicles on Datalink panel. Or in artillery computer fire find laser spots, and hot (per IR) or cold (per Visual) vehicles.)
-reworked 82mm/120/155mm/230mm MultiGuided, to be more accurate and be Multi Target
-reworked Static AT & ATGM, changed ammo from 4 HEAT & 2 HE to new 4 MT (MultiTarget) rounds, Static AT now has more locking options and also SACLOS
-reworked 120mm charges
-multi guided successfully tested to include gps guidance, but so far only when using artillery computer
-artillery weapon edits in steps, so different versions can be chosen V1 until V4
-split shown ELDiff, and ElDiff for used calculation, to not cause errors
-enabled NLOS for locking ATGM
-tweaked AT mine spread
-reworked 120mm, 155mm, 230mm Airburst, to truly explode before impact (instead of being reset 20meters after impact)
-minor change to howitzer max gun elevation for it be able to shoot closer during compound defense
-added RC RespawnTruck & correct driver camera screen with filter
-reworked Laser Guided 2m Delayed Fuse
-added nightvision to RC RespawnTruck driver camera
-done lots of testing and decided on MT MultiGuided visual model
-added LaserDatalink so that handheld LaserDesignators enable reliable use with Artillery, and decreases reliance of UAV's with Datalink
-testing showed that locking MultiGuided to laser target, firing manual, deactivating laser, has 3 practical results:
	if nothing else is close it switches to gps guidance,
	or if enemy vehicles are close it locks on them,
	which is extremly usefull if the ForwardObserver is suppressed and cannot maintain the lase,
	if the laser is reactivated, it relocks if it is close enough to the original point
-added N/LOS FSV
-fixed Airburst
-added AR1/AR3 backpacks
-improved mine spread
-improved the FOV of N/LOS FSV, and improved its muzzle smoke effect
-added muzzle position estimation formula in the script
-added ammo usage flags for ai
-fixed sound and effects for new artillery ammunition
-added ground dust effect for airburst
-added LOS FSV
-added Datalink Guided Missles for LOS FSV
-added FSV hpp and subcategory
-individualized ground dust radius and amount of airburst for calibers, and increased dust time
-added 105mm for later use (no suited platform yet found)
-updated remove/addmagazine list, and included as txt
-added missle approach warning systems
-changed uav connection script location
-added MBT 2+6
-added wide gunner FOV and fluid zoom to MBT
-added script to remove FSV & MBT script to remove gunner and commander, also to turn of engine when standing still (despite not being ugv gunner/commander)
-added wide commander FOV and fluid zoom for FSV & MBT
-added RC IC commander seat and improved RC driving by using gunner seat and its better camera position
-added AR-1&3 for all sides with correct textures
-added Grenade Dropping UAV
-updated vehicle inventory, remove 6.5mm rifles and magazines, added toolkits etc
-added mine detectors to frontline personel carring vehicles
-reduced Mortar/Howitzer AI firerate to 1 in 15sec to waste less ammo
-added vehicle mortar, to attach onto vehicles as composition, with edited elevation to allow low trajectory fire shortening TOF
-added more version of respawn vehicles, and reduced threat/cost so it doesnt get engaged
-simplified naming of 120mm magazines
-aligned by +-50 MIL now show up as yellow, to align quicker and not accidently go past it
-double checked LaserDatalink code
-fixed Artillery UI staying when asset is destroyed
-fixed respawn position script, but it might be global duplicating it per person
-added new seatlock, case 4 locks only commander seat
-removed Ti from AR-1 as it isnt effected by the ppeffects script
-updated the seat UV lock script, to be usable for FSV/MBT, to unlock seats again when not in UV control
-added if (!isserver) exitwith {}; to eventhandlers so its not executed multiple times

-MAJOR breakthrough: added datalink target firing solution, sideeffect is that it shows firing solution for line of sight if looking at an object
-added laserlock to HEAB, so it can select laser (and vehicles) on datalink for a firing solution (not suited to other rounds with distancetotarget=x, except for guided)
-changed magazine RC_AimAboveHeight to airburstheight -1m, as it doesnt make a difference with medium trajectory, but on high charge very flat trajectory it overshoots sicnificantly less, also prevents overshoot of on hilltop targets
*note some overshoot on high charge is left likely due to decreased accuracy
-instead of seperate display, added RC_AimAboveHeight to 0.7*triggerdistance for guided, to have 45deg toptown effect even on high charge for shorter TOF, to not get stuck in foliage/cover
-finally found correct values to make guided shells accurate at high charge instead of completly overshoot
-added script that changes Airburst to Impact when turret elevation is too low for Airburst to work savely
-found a way to enable gps targeting! (slightly more work needed to integrate it)


-low/high trajectory list:
	low: HEAB, Guided (Guided has integrated topdown)
	high: Cluster, Smoke, AT/AP Mines, Illum


DONE - QUALITY OF LIFE:

-lower FOV for better driving now available
-option for shorter map marker search
-if vehicle speed = 0 then engine is turned off
-map now available for all assets!
-significant mod folder and hpp restructure


---------------------------------------------------------------------------------------------------------


Previous Update:

TO DO - BUGFIXES:

-figure out why MRL and sometimes Howitzer shoots left/right if not aligned...


DONE - BUGFIXES:

-remove human crew hpp and hpp include in config
-hasdriver=-1 removed from all vics
-added lockdriver/commander to likely all vics
-all vehicles now steerable again
-target range cut off when 5 digits
-target cycle keybinds (4 is MRS/MLRS charge) change to 3 and 5

-fix RC_ATGM privated
-fix loop when joining server


TO DO - FEATURES:

-HE airburst, 82mm, 120mm, 155mm, 230mm

-magazine shell count attributes code? (Who wrote this, what is meant by it?)
-only disable driver = 4, for modularity

-explain target marker referencing to current subscribers


DONE - FEATURES:

-RCdisableseats= 1 for loacking commander seat  2 for locking driver and commander seat
-isRCarty=1;  as mod friendly check if display should appear
-howitzer can drive in gunner seat
-added target marker referencing, calculation and display

-added 230mm laser guided and AT guided rockets (unclear if they work)

-added 


TO DO - QUALITY OF LIFE:

-light off! esp Recon Nyx

-if vehicle speed = 0 then turn off engine true
-cannot open map with: mortar, MRL, static AA / AT / ATGM, laser des

-if turret azimuth matches target azimuth, turn green
-if charge is correct for target distance, turn green

-improve turret elevation formula, that accounts for elevation difference better


DONE - QUALITY OF LIFE:

-create basic turret elevation formula https://www.desmos.com/calculator/fsya2kyque?lang=de
